"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7676],{9136:function(e,t,r){r.r(t),r.d(t,{contentTitle:function(){return l},default:function(){return k},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return m}});var n=r(5773),a=r(808),i=(r(7378),r(5318)),p=r(517),o=r(7637),d=["components"],s={id:"server-side-rendering",title:"Server Side Rendering",sidebar_label:"Server Side Rendering",hide_title:!0,description:"RTK Query > \uc0ac\uc6a9\ubc95 > Server Side Rendering"},l=void 0,u={unversionedId:"rtk-query/usage/server-side-rendering",id:"rtk-query/usage/server-side-rendering",isDocsHomePage:!1,title:"Server Side Rendering",description:"RTK Query > \uc0ac\uc6a9\ubc95 > Server Side Rendering",source:"@site/../docs/rtk-query/usage/server-side-rendering.mdx",sourceDirName:"rtk-query/usage",slug:"/rtk-query/usage/server-side-rendering",permalink:"/redux-toolkit/rtk-query/usage/server-side-rendering",tags:[],version:"current",lastUpdatedAt:1656245256,formattedLastUpdatedAt:"6/26/2022",frontMatter:{id:"server-side-rendering",title:"Server Side Rendering",sidebar_label:"Server Side Rendering",hide_title:!0,description:"RTK Query > \uc0ac\uc6a9\ubc95 > Server Side Rendering"},sidebar:"docs",previous:{title:"\ucf54\ub4dc \uc0dd\uc131",permalink:"/redux-toolkit/rtk-query/usage/code-generation"},next:{title:"Persistence and Rehydration",permalink:"/redux-toolkit/rtk-query/usage/persistence-and-rehydration"}},m=[{value:"Server Side Rendering with Next.js",id:"server-side-rendering-with-nextjs",children:[],level:2},{value:"Server Side Rendering elsewhere",id:"server-side-rendering-elsewhere",children:[],level:2}],c={toc:m};function k(e){var t=e.components,r=(0,a.Z)(e,d);return(0,i.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"server-side-rendering"},"Server Side Rendering"),(0,i.kt)("h2",{id:"server-side-rendering-with-nextjs"},"Server Side Rendering with Next.js"),(0,i.kt)("p",null,"RTK Query\ub294 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/kirill-konshin/next-redux-wrapper"},"next-redux-wrapper")," \uc640 ",(0,i.kt)("a",{parentName:"p",href:"/redux-toolkit/rtk-query/usage/persistence-and-rehydration"},"rehydration")," \ub97c \uc0ac\uc6a9\ud558\uc5ec ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next.js")," \ub97c \ud1b5\ud55c Server Side Rendering(SSR)\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4."),(0,i.kt)("p",null,"\uc6cc\ud06c\ud50c\ub85c\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"next-redux-wrapper")," \uc124\uc815")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"getStaticProps")," \ub610\ub294 ",(0,i.kt)("inlineCode",{parentName:"p"},"getServerSideProps")," \uc5d0\uc11c:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"'initiate' action\uc744 \ud1b5\ud574 \ubaa8\ub4e0 \ucffc\ub9ac\uc5d0 \ub300\ud574 pre-fetch\ub97c \uc9c4\ud589\ud569\ub2c8\ub2e4. e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"store.dispatch(api.endpoints.getPokemonByName.initiate(name))")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"await Promise.all(api.util.getRunningOperationPromises())")," \ub97c \ud1b5\ud574 \uac01 query\uac00 \uc644\ub8cc\ub420 \ub54c \uae4c\uc9c0 \uae30\ub2e4\ub9bd\ub2c8\ub2e4."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"createApi")," \ud638\ucd9c\uc5d0\uc11c ",(0,i.kt)("inlineCode",{parentName:"p"},"extractRehydrationInfo")," \uc635\uc158\uc744 \uc0ac\uc6a9\ud558\uc5ec rehydration \uc744 \uad6c\uc131\ud569\ub2c8\ub2e4:"),(0,i.kt)(o.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,i.kt)(p.Z,{value:"ts",mdxType:"TabItem"},(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="next-redux-wrapper rehydration example"',title:'"next-redux-wrapper',rehydration:!0,'example"':!0},"import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport { HYDRATE } from 'next-redux-wrapper'\n\nexport const api = createApi({\n  baseQuery: fetchBaseQuery({ baseUrl: '/' }),\n  // highlight-start\n  extractRehydrationInfo(action, { reducerPath }) {\n    if (action.type === HYDRATE) {\n      return action.payload[reducerPath]\n    }\n  },\n  // highlight-end\n  endpoints: (build) => ({\n    // omitted\n  }),\n})\n"))),(0,i.kt)(p.Z,{value:"js",mdxType:"TabItem"},(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="next-redux-wrapper rehydration example"',title:'"next-redux-wrapper',rehydration:!0,'example"':!0},"import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport { HYDRATE } from 'next-redux-wrapper'\n\nexport const api = createApi({\n  baseQuery: fetchBaseQuery({ baseUrl: '/' }),\n  // highlight-start\n  extractRehydrationInfo(action, { reducerPath }) {\n    if (action.type === HYDRATE) {\n      return action.payload[reducerPath]\n    }\n  },\n  // highlight-end\n  endpoints: (build) => ({\n    // omitted\n  }),\n})\n")))))),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/phryneas/ssr-experiments/tree/main/nextjs-blog"},"\uc5ec\uae30")," \uc11c ",(0,i.kt)("inlineCode",{parentName:"p"},"next.js")," \ub97c \uc0ac\uc6a9\ud55c \uc608\uc2dc repo\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"\uba54\ubaa8\ub9ac \ub204\uc218\uac00 \uc608\uc0c1\ub418\uc9c0\ub294 \uc54a\uc9c0\ub9cc, render\uac00 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 \uc804\uc1a1\ub418\uace0 store\uac00 \uba54\ubaa8\ub9ac\uc5d0\uc11c \uc81c\uac70\ub418\uba74,\n",(0,i.kt)("inlineCode",{parentName:"p"},"store.dispatch(api.util.resetApiState())"),"\ub97c \ud638\ucd9c\ud558\uc5ec\n\ub3d9\uc791\ud558\uace0 \uc788\ub294 \ub0a8\uc740 rogue timer\uac00 \uc5c6\ub3c4\ub85d \uba85\ud655\ud558\uac8c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."))),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Static Site Generation (SSG) \uc5d0\uc11c \uc624\ub798\ub41c \ub370\uc774\ud130\ub97c \uc81c\uacf5\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\uae30 \uc704\ud574,\n\ud398\uc774\uc9c0\uac00 \uc0dd\uc131\ub41c \uc9c0 \uc624\ub798 \ub41c \uacbd\uc6b0 \uc561\uc138\uc2a4\ud560 \ub54c \ub370\uc774\ud130\ub97c \ub2e4\uc2dc \uac00\uc838\uc62c \uc218 \uc788\ub3c4\ub85d\n",(0,i.kt)("a",{parentName:"p",href:"/redux-toolkit/rtk-query/api/createApi#refetchonmountorargchange"},(0,i.kt)("inlineCode",{parentName:"a"},"refetchOnMountOrArgChange"))," \ub97c\n900\uacfc \uac19\uc740 \ud569\ub9ac\uc801\uc778 \uac12\uc73c\ub85c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."))),(0,i.kt)("h2",{id:"server-side-rendering-elsewhere"},"Server Side Rendering elsewhere"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"next.js"),"\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0, \uc704\uc758 \uc608\ub97c SSR \ud504\ub808\uc784\uc6cc\ud06c\uc5d0 \uc801\uc6a9\ud560 \uc218 \uc5c6\ub294 \uacbd\uc6b0,\n",(0,i.kt)("inlineCode",{parentName:"p"},"unstable__"),"\ub85c \ud45c\uc2dc\ub41c \uc811\uadfc \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub80c\ub354\ub9c1 \uc911\uc5d0 \ube44\ub3d9\uae30 \ucf54\ub4dc\ub97c \uc2e4\ud589\ud574\uc57c \ud558\uace0\neffect\uc5d0\uc11c \uc548\uc804\ud558\uc9c0 \uc54a\uc740 SSR \uc2dc\ub098\ub9ac\uc624\ub97c \uc9c0\uc6d0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\nThis is a similar approach to using ",(0,i.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/react/performance/server-side-rendering/#executing-queries-with-getdatafromtree"},(0,i.kt)("inlineCode",{parentName:"a"},"getDataFromTree")),"\nwith ",(0,i.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/"},"Apollo"),"."),(0,i.kt)("p",null,"The workflow is as follows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Create a version of ",(0,i.kt)("inlineCode",{parentName:"p"},"createApi")," that performs asynchronous work during render:"),(0,i.kt)(o.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,i.kt)(p.Z,{value:"ts",mdxType:"TabItem"},(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"import {\n  buildCreateApi,\n  coreModule,\n  reactHooksModule,\n} from '@reduxjs/toolkit/query/react'\n\nconst createApi = buildCreateApi(\n  coreModule(),\n  reactHooksModule({ unstable__sideEffectsInRender: true })\n)\n"))),(0,i.kt)(p.Z,{value:"js",mdxType:"TabItem"},(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import {\n  buildCreateApi,\n  coreModule,\n  reactHooksModule,\n} from '@reduxjs/toolkit/query/react'\n\nconst createApi = buildCreateApi(\n  coreModule(),\n  reactHooksModule({ unstable__sideEffectsInRender: true })\n)\n"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Use your custom ",(0,i.kt)("inlineCode",{parentName:"p"},"createApi")," when calling ",(0,i.kt)("inlineCode",{parentName:"p"},"const api = createApi({...})"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Wait for all queries to finish using ",(0,i.kt)("inlineCode",{parentName:"p"},"await Promise.all(api.util.getRunningOperationPromises())")," before performing the next render cycle"))))}k.isMDXComponent=!0}}]);